<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">

    <script type="text/javascript" src="jsPsych/jspsych.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script type="text/javascript" src="jsPsych/plugins/jspsych-survey-text.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="jsPsych/css/jspsych.css" rel="stylesheet" type="text/css"/>

  </head>
  <body>
  </body>

  <script>


    // Get participant information and use it to derive their condition number.

    var ID = window.prompt("Enter your participant ID:")

    while (!Object.keys(conditions).includes(ID)) {

	var ID = window.prompt("ID not found. Please check again, or contact the experimenter.")

    }

    // var condition = conditions[ID]

    var condition = ID
    var layout = Math.floor(condition/24)+1

    // Setup the probability layouts

    var l1 = [.001, .05, .03]
    var l2 = [.005, .045, .025]
    var l3 = [.03, .2, .15]
    var l4 = [.07, .09, .1]

    //

    var Morad_stories = {1: "Morad Conditional high",
			 2: "Morad Conditional low",
			 3: "Morad Unconditional high",
			 4: "Morad Unconditional low"}

    var Wodget_stories = {1: "Wodget Conditional high",
			 2: "Wodget Conditional low",
			 3: "Wodget Unconditional high",
			 4: "Wodget Unconditional low"}

    var Mondel_stories = {1: "Mondel Conditional high",
			 2: "Mondel Conditional low",
			 3: "Mondel Unconditional high",
			 4: "Mondel Unconditional"}
    
    var Myastorm_stories = {1: "Myastorm Conditional high",
			 2: "Myastorm Conditional low",
			 3: "Myastorm Unconditional high",
			 4: "Myastorm Unconditional low"}

    // Structure and assemble the experiment.
    
    var timeline = []

    var welcome = {type: "html-keyboard-response",
		   stimulus: "Welcome to the experiment, and thank you for your time! Press any key to continue."
		  };
    timeline.push(welcome)

    var instructions = {type: "html-keyboard-response",
			stimulus: "In this experiment, you will be asked to estimate various quantites, based on information that we provide you. Information will be presented in story form. For each story, you will be asked multiple questions, and then be given more information. This will happen multiple times. When answering the questions, please keep in mind all of what you know about the situation. <p>Press the spacebar to continue.</p>",
			choices: [32]
		       };

    timeline.push(instructions)

    
    
    jsPsych.init({
	timeline: timeline,
	on_finish: function() {
	    $.ajax({
		type: "POST",
		url: "/experiment-data",
		data: jsPsych.data.get().json(),
		contentType: "application/json"
	    })
		.done(function() {
		    alert("Thank you!")
		})
		.fail(function() {
		    alert("A problem occurred while writing to the database. Please contact the researcher for more information.")
		})
	}
    })

    </script>
</html>
